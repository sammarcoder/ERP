  {
            "id": 82,
            "date": "2026-01-21T00:00:00.000Z",
            "stk_Main_ID": 132,
            "voucherTypeId": 12,
            "voucherNo": "SV-1",
            "balacingId": null,
            "status": 0,
            "isOpening": 0,
            "createdAt": "2026-01-21T10:05:44.000Z",
            "updatedAt": "2026-01-21T10:05:44.000Z",
            "Journaldetail__id": 555,
            "Journaldetail__jmId": 82,
            "Journaldetail__lineId": 1,
            "Journaldetail__coaId": 138,
            "Journaldetail__description": "S.Inv, testing Sub customer, Testong City",
            "Journaldetail__chqNo": null,
            "Journaldetail__recieptNo": "",
            "Journaldetail__ownDb": 0,
            "Journaldetail__ownCr": 0,
            "Journaldetail__rate": 0,
            "Journaldetail__amountDb": 36630,
            "Journaldetail__amountCr": 0,
            "Journaldetail__isCost": 0,
            "Journaldetail__currencyId": 1,
            "Journaldetail__status": 0,
            "Journaldetail__createdAt": "2026-01-21T10:05:44.000Z",
            "Journaldetail__updatedAt": "2026-01-21T10:05:44.000Z",
            "Journaldetail__idCard": null,
            "Journaldetail__bank": null,
            "Journaldetail__bankDate": null,
            "Zvouchertype__id": 12,
            "Zvouchertype__vType": "sales",
            "Zvouchertype__createdAt": "2025-10-06T00:00:00.000Z",
            "Zvouchertype__updatedAt": "2025-10-06T00:00:00.000Z",
            "Zcurrencies__id": 1,
            "Zcurrencies__currencyName": "Pkr",
            "Zcoas__id": 138,
            "Zcoas__acName": "testing for orders",
            "Zcoas__Transporter_ID": 2,
            "Ztransporter__id": 2,
            "Ztransporter__name": "لاہور مشترقہ"
        },


























SELECT
  `journalmaster`.`id` AS `id`,
  `journalmaster`.`date` AS `date`,
  `journalmaster`.`stk_Main_ID` AS `stk_Main_ID`,
  `journalmaster`.`voucherTypeId` AS `voucherTypeId`,
  `journalmaster`.`voucherNo` AS `voucherNo`,
  `journalmaster`.`balacingId` AS `balacingId`,
  `journalmaster`.`status` AS `status`,
  `journalmaster`.`isOpening` AS `isOpening`,
  `journalmaster`.`createdAt` AS `createdAt`,
  `journalmaster`.`updatedAt` AS `updatedAt`,
  `Journaldetail`.`id` AS `Journaldetail__id`,
  `Journaldetail`.`jmId` AS `Journaldetail__jmId`,
  `Journaldetail`.`lineId` AS `Journaldetail__lineId`,
  `Journaldetail`.`coaId` AS `Journaldetail__coaId`,
  `Journaldetail`.`description` AS `Journaldetail__description`,
  `Journaldetail`.`chqNo` AS `Journaldetail__chqNo`,
  `Journaldetail`.`recieptNo` AS `Journaldetail__recieptNo`,
  `Journaldetail`.`ownDb` AS `Journaldetail__ownDb`,
  `Journaldetail`.`ownCr` AS `Journaldetail__ownCr`,
  `Journaldetail`.`rate` AS `Journaldetail__rate`,
  `Journaldetail`.`amountDb` AS `Journaldetail__amountDb`,
  `Journaldetail`.`amountCr` AS `Journaldetail__amountCr`,
  `Journaldetail`.`isCost` AS `Journaldetail__isCost`,
  `Journaldetail`.`currencyId` AS `Journaldetail__currencyId`,
  `Journaldetail`.`status` AS `Journaldetail__status`,
  `Journaldetail`.`createdAt` AS `Journaldetail__createdAt`,
  `Journaldetail`.`updatedAt` AS `Journaldetail__updatedAt`,
  `Journaldetail`.`idCard` AS `Journaldetail__idCard`,
  `Journaldetail`.`bank` AS `Journaldetail__bank`,
  `Journaldetail`.`bankDate` AS `Journaldetail__bankDate`,
  `Zvouchertype - VoucherTypeId`.`id` AS `Zvouchertype - VoucherTypeId__id`,
  `Zvouchertype - VoucherTypeId`.`vType` AS `Zvouchertype - VoucherTypeId__vType`,
  `Zvouchertype - VoucherTypeId`.`createdAt` AS `Zvouchertype - VoucherTypeId__createdAt`,
  `Zvouchertype - VoucherTypeId`.`updatedAt` AS `Zvouchertype - VoucherTypeId__updatedAt`,
  `Zcurrencies - CurrencyId`.`id` AS `Zcurrencies - CurrencyId__id`,
  `Zcurrencies - CurrencyId`.`currencyName` AS `Zcurrencies - CurrencyId__currencyName`,
  `Zcurrencies - CurrencyId`.`createdAt` AS `Zcurrencies - CurrencyId__createdAt`,
  `Zcurrencies - CurrencyId`.`updatedAt` AS `Zcurrencies - CurrencyId__updatedAt`,
  `Zcoas - CoaId`.`id` AS `Zcoas - CoaId__id`,
  `Zcoas - CoaId`.`acName` AS `Zcoas - CoaId__acName`,
  `Zcoas - CoaId`.`ch1Id` AS `Zcoas - CoaId__ch1Id`,
  `Zcoas - CoaId`.`ch2Id` AS `Zcoas - CoaId__ch2Id`,
  `Zcoas - CoaId`.`coaTypeId` AS `Zcoas - CoaId__coaTypeId`,
  `Zcoas - CoaId`.`setupName` AS `Zcoas - CoaId__setupName`,
  `Zcoas - CoaId`.`adress` AS `Zcoas - CoaId__adress`,
  `Zcoas - CoaId`.`city` AS `Zcoas - CoaId__city`,
  `Zcoas - CoaId`.`personName` AS `Zcoas - CoaId__personName`,
  `Zcoas - CoaId`.`mobileNo` AS `Zcoas - CoaId__mobileNo`,
  `Zcoas - CoaId`.`taxStatus` AS `Zcoas - CoaId__taxStatus`,
  `Zcoas - CoaId`.`ntn` AS `Zcoas - CoaId__ntn`,
  `Zcoas - CoaId`.`cnic` AS `Zcoas - CoaId__cnic`,
  `Zcoas - CoaId`.`salesLimit` AS `Zcoas - CoaId__salesLimit`,
  `Zcoas - CoaId`.`credit` AS `Zcoas - CoaId__credit`,
  `Zcoas - CoaId`.`creditDoys` AS `Zcoas - CoaId__creditDoys`,
  `Zcoas - CoaId`.`salesMan` AS `Zcoas - CoaId__salesMan`,
  `Zcoas - CoaId`.`isJvBalance` AS `Zcoas - CoaId__isJvBalance`,
  `Zcoas - CoaId`.`discountA` AS `Zcoas - CoaId__discountA`,
  `Zcoas - CoaId`.`discountB` AS `Zcoas - CoaId__discountB`,
  `Zcoas - CoaId`.`discountC` AS `Zcoas - CoaId__discountC`,
  `Zcoas - CoaId`.`createdAt` AS `Zcoas - CoaId__createdAt`,
  `Zcoas - CoaId`.`updatedAt` AS `Zcoas - CoaId__updatedAt`,
  `Zcoas - CoaId`.`batch_no` AS `Zcoas - CoaId__batch_no`,
  `Zcoas - CoaId`.`Transporter_ID` AS `Zcoas - CoaId__Transporter_ID`,
  `Zcoas - CoaId`.`freight_crt` AS `Zcoas - CoaId__freight_crt`,
  `Zcoas - CoaId`.`labour_crt` AS `Zcoas - CoaId__labour_crt`,
  `Zcoas - CoaId`.`bility_expense` AS `Zcoas - CoaId__bility_expense`,
  `Zcoas - CoaId`.`other_expense` AS `Zcoas - CoaId__other_expense`,
  `Zcoas - CoaId`.`foreign_currency` AS `Zcoas - CoaId__foreign_currency`,
  `Zcoas - CoaId`.`sub_customer` AS `Zcoas - CoaId__sub_customer`,
  `Zcoas - CoaId`.`sub_city` AS `Zcoas - CoaId__sub_city`,
  `Zcoas - CoaId`.`str` AS `Zcoas - CoaId__str`,
  `Zcoas - CoaId`.`isPettyCash` AS `Zcoas - CoaId__isPettyCash`,
  `Ztransporter - Transporter`.`id` AS `Ztransporter - Transporter__id`,
  `Ztransporter - Transporter`.`name` AS `Ztransporter - Transporter__name`,
  `Ztransporter - Transporter`.`contactPerson` AS `Ztransporter - Transporter__contactPerson`,
  `Ztransporter - Transporter`.`phone` AS `Ztransporter - Transporter__phone`,
  `Ztransporter - Transporter`.`address` AS `Ztransporter - Transporter__address`,
  `Ztransporter - Transporter`.`isActive` AS `Ztransporter - Transporter__isActive`,
  `Ztransporter - Transporter`.`createdAt` AS `Ztransporter - Transporter__createdAt`,
  `Ztransporter - Transporter`.`updatedAt` AS `Ztransporter - Transporter__updatedAt`
FROM
  `journalmaster`
 
LEFT JOIN (
    SELECT
      `journaldetail`.`id` AS `id`,
      `journaldetail`.`jmId` AS `jmId`,
      `journaldetail`.`lineId` AS `lineId`,
      `journaldetail`.`coaId` AS `coaId`,
      `journaldetail`.`description` AS `description`,
      `journaldetail`.`chqNo` AS `chqNo`,
      `journaldetail`.`recieptNo` AS `recieptNo`,
      `journaldetail`.`ownDb` AS `ownDb`,
      `journaldetail`.`ownCr` AS `ownCr`,
      `journaldetail`.`rate` AS `rate`,
      `journaldetail`.`amountDb` AS `amountDb`,
      `journaldetail`.`amountCr` AS `amountCr`,
      `journaldetail`.`isCost` AS `isCost`,
      `journaldetail`.`currencyId` AS `currencyId`,
      `journaldetail`.`status` AS `status`,
      `journaldetail`.`createdAt` AS `createdAt`,
      `journaldetail`.`updatedAt` AS `updatedAt`,
      `journaldetail`.`idCard` AS `idCard`,
      `journaldetail`.`bank` AS `bank`,
      `journaldetail`.`bankDate` AS `bankDate`
    FROM
      `journaldetail`
  ) AS `Journaldetail` ON `journalmaster`.`id` = `Journaldetail`.`jmId`
  LEFT JOIN (
    SELECT
      `zvouchertype`.`id` AS `id`,
      `zvouchertype`.`vType` AS `vType`,
      `zvouchertype`.`createdAt` AS `createdAt`,
      `zvouchertype`.`updatedAt` AS `updatedAt`
    FROM
      `zvouchertype`
  ) AS `Zvouchertype - VoucherTypeId` ON `journalmaster`.`voucherTypeId` = `Zvouchertype - VoucherTypeId`.`id`
  LEFT JOIN (
    SELECT
      `zcurrencies`.`id` AS `id`,
      `zcurrencies`.`currencyName` AS `currencyName`,
      `zcurrencies`.`createdAt` AS `createdAt`,
      `zcurrencies`.`updatedAt` AS `updatedAt`
    FROM
      `zcurrencies`
  ) AS `Zcurrencies - CurrencyId` ON `Journaldetail`.`currencyId` = `Zcurrencies - CurrencyId`.`id`
  LEFT JOIN (
    SELECT
      `zcoas`.`id` AS `id`,
      `zcoas`.`acName` AS `acName`,
      `zcoas`.`ch1Id` AS `ch1Id`,
      `zcoas`.`ch2Id` AS `ch2Id`,
      `zcoas`.`coaTypeId` AS `coaTypeId`,
      `zcoas`.`setupName` AS `setupName`,
      `zcoas`.`adress` AS `adress`,
      `zcoas`.`city` AS `city`,
      `zcoas`.`personName` AS `personName`,
      `zcoas`.`mobileNo` AS `mobileNo`,
      `zcoas`.`taxStatus` AS `taxStatus`,
      `zcoas`.`ntn` AS `ntn`,
      `zcoas`.`cnic` AS `cnic`,
      `zcoas`.`salesLimit` AS `salesLimit`,
      `zcoas`.`credit` AS `credit`,
      `zcoas`.`creditDoys` AS `creditDoys`,
      `zcoas`.`salesMan` AS `salesMan`,
      `zcoas`.`isJvBalance` AS `isJvBalance`,
      `zcoas`.`discountA` AS `discountA`,
      `zcoas`.`discountB` AS `discountB`,
      `zcoas`.`discountC` AS `discountC`,
      `zcoas`.`createdAt` AS `createdAt`,
      `zcoas`.`updatedAt` AS `updatedAt`,
      `zcoas`.`batch_no` AS `batch_no`,
      `zcoas`.`Transporter_ID` AS `Transporter_ID`,
      `zcoas`.`freight_crt` AS `freight_crt`,
      `zcoas`.`labour_crt` AS `labour_crt`,
      `zcoas`.`bility_expense` AS `bility_expense`,
      `zcoas`.`other_expense` AS `other_expense`,
      `zcoas`.`foreign_currency` AS `foreign_currency`,
      `zcoas`.`sub_customer` AS `sub_customer`,
      `zcoas`.`sub_city` AS `sub_city`,
      `zcoas`.`str` AS `str`,
      `zcoas`.`isPettyCash` AS `isPettyCash`
    FROM
      `zcoas`
  ) AS `Zcoas - CoaId` ON `Journaldetail`.`coaId` = `Zcoas - CoaId`.`id`
  LEFT JOIN (
    SELECT
      `ztransporter`.`id` AS `id`,
      `ztransporter`.`name` AS `name`,
      `ztransporter`.`contactPerson` AS `contactPerson`,
      `ztransporter`.`phone` AS `phone`,
      `ztransporter`.`address` AS `address`,
      `ztransporter`.`isActive` AS `isActive`,
      `ztransporter`.`createdAt` AS `createdAt`,
      `ztransporter`.`updatedAt` AS `updatedAt`
    FROM
      `ztransporter`
  ) AS `Ztransporter - Transporter` ON `Zcoas - CoaId`.`Transporter_ID` = `Ztransporter - Transporter`.`id`
LIMIT
  1048575

router.get('/reports/get_BF_RF', async (req, res) => {
  try {
    // Step 1: Get the last Journal Voucher entry
    const lastEntry = await JournalMaster.findOne({
      where: {
        voucherTypeId: 10
      },
      order: [['id', 'DESC']]
    });

    if (!lastEntry) {
      return res.status(404).json({ 
        success: false, 
        message: 'No Journal Voucher entries found' 
      });
    }

    console.log('Last JV Entry:', lastEntry.toJSON());

    // Step 2: Extract the date
    const lastDate = lastEntry.date;

    // Step 3: Get ALL JournalMaster entries UP TO that date (all voucher types)
    const allEntries = await JournalMaster.findAll({
      where: {
        date: {
          [Op.lte]: lastDate  // Less than or equal to last date
        },
        is_partially_deleted: false
      },
      attributes: ['id', 'date', 'voucherTypeId'],
      include: [{
        model: JournalDetail,
        as: 'details',
        where: { coaId:req.query.coaId ? req.query.coaId : { [Op.ne]: null } },
        required: false,
        attributes: ['id','description', 'jmId', 'coaId', 'amountDb', 'amountCr']
      }],
      order: [['date', 'ASC'], ['id', 'ASC']]
    });

    console.log(`Found ${allEntries.length} entries up to date: ${lastDate}`);

    res.json({ 
      success: true, 
      upToDate: lastDate,
      count: allEntries.length,
      data: allEntries 
    });

  } catch (error) {
    console.error('Error fetching entries:', error);
    res.status(500).json({ 
      success: false, 
      message: 'Error fetching entries',
      error: error.message 
    });
  }
});
 so now this is the api
{
    "success": true,
    "upToDate": "2026-01-23T00:00:00.000Z",
    "count": 6,
    "data": [
        {
            "id": 82,
            "date": "2026-01-21T00:00:00.000Z",
            "voucherTypeId": 12,
            "details": []
        },
        {
            "id": 88,
            "date": "2026-01-23T00:00:00.000Z",
            "voucherTypeId": 10,
            "details": [
                {
                    "id": 596,
                    "description": "testing",
                    "jmId": 88,
                    "coaId": 140,
                    "amountDb": 0,
                    "amountCr": 1000
                },
                {
                    "id": 597,
                    "description": "testing",
                    "jmId": 88,
                    "coaId": 140,
                    "amountDb": 0,
                    "amountCr": 10000
                }
            ]
        },
        {
            "id": 89,
            "date": "2026-01-23T00:00:00.000Z",
            "voucherTypeId": 14,
            "details": [
                {
                    "id": 607,
                    "description": "test",
                    "jmId": 89,
                    "coaId": 140,
                    "amountDb": 1000,
                    "amountCr": 0
                }
            ]
        },
        {
            "id": 90,
            "date": "2026-01-23T00:00:00.000Z",
            "voucherTypeId": 10,
            "details": [
                {
                    "id": 613,
                    "description": "testing 2",
                    "jmId": 90,
                    "coaId": 140,
                    "amountDb": 1000,
                    "amountCr": 0
                },
                {
                    "id": 614,
                    "description": "testing 2",
                    "jmId": 90,
                    "coaId": 140,
                    "amountDb": 0,
                    "amountCr": 1000
                }
            ]
        },
        {
            "id": 91,
            "date": "2026-01-23T00:00:00.000Z",
            "voucherTypeId": 10,
            "details": []
        },
        {
            "id": 92,
            "date": "2026-01-23T00:00:00.000Z",
            "voucherTypeId": 10,
            "details": []
        }
    ]
} this is the data 

# Now i have to integerate the bf and cf in my journal voucher when create or edit.
# I am going to explain to you hwo this is going to be work as you you know in the journal master we have all the voucehrs journal and petty and sales and purchase ad lc 
# First understand the functionality of the this api it fetches the last record of the journal master and extract the date and than fetch all the the voucher of the journal master sales, purchse etc but one more things the coacoaId
# if you remebr when we create the journal VOucehr in the header we ahce the auto select coa which is link with the auto balance row if made so this coa id will be sent tot the this api 
than all the record deatils we will get sum the all credit row  and debit andthan bf = debit - credit and cf = bf+ auto blance entry if debit than (-amount ) and if credit than (amount)


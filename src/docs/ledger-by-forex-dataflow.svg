<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="700" viewBox="0 0 1200 700">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,5 L0,10 z" fill="#333"/>
    </marker>
    <style>
      .box { fill:#fff; stroke:#334155; stroke-width:1.5; rx:8; }
      .title { font: 700 14px/1.2 'Inter', Arial; fill:#0f172a; }
      .label { font: 13px/1.2 'Inter', Arial; fill:#0f172a; }
      .small { font: 11px/1.1 'Inter', Arial; fill:#475569; }
      .arrow { stroke:#334155; stroke-width:1.6; fill:none; marker-end: url(#arrow); }
      .group-title { font: 700 16px/1.2 'Inter', Arial; fill:#083344; }
    </style>
  </defs>

  <!-- Title -->
  <text x="600" y="28" text-anchor="middle" class="group-title">Ledger-by-Forex — Data Flow</text>

  <!-- Server / Metabase column -->
  <text x="120" y="60" text-anchor="start" class="small">Server & Data Layer</text>

  <g transform="translate(60,90)">
    <rect class="box" x="0" y="0" width="220" height="56" />
    <text x="110" y="32" text-anchor="middle" class="title">Metabase</text>
    <text x="110" y="48" text-anchor="middle" class="small">(Metabase API / Cards)</text>

    <rect class="box" x="0" y="100" width="220" height="56" />
    <text x="110" y="132" text-anchor="middle" class="title">metabaseService.ts</text>
    <text x="110" y="148" text-anchor="middle" class="small">authenticate() / getQuestionData()</text>

    <rect class="box" x="0" y="200" width="260" height="66" />
    <text x="130" y="238" text-anchor="middle" class="title">/app/api/journalmaster/route.ts</text>
    <text x="130" y="256" text-anchor="middle" class="small">calls metabaseService.getQuestionData(103)</text>

    <rect class="box" x="0" y="300" width="260" height="56" />
    <text x="130" y="332" text-anchor="middle" class="title">dataConverter.ts</text>
    <text x="130" y="348" text-anchor="middle" class="small">convertToCleanFormat(rawData)</text>

    <rect class="box" x="0" y="380" width="260" height="66" />
    <text x="130" y="416" text-anchor="middle" class="title">filters/dataProcessor.ts</text>
    <text x="130" y="434" text-anchor="middle" class="small">DataFilter.applyAllFilters() → filterOptions</text>

    <rect class="box" x="0" y="470" width="260" height="56" />
    <text x="130" y="502" text-anchor="middle" class="title">API Response</text>
    <text x="130" y="518" text-anchor="middle" class="small">{ data: filteredRows, filterOptions, stats }</text>
  </g>

  <!-- Arrows server -->
  <path class="arrow" d="M180 146 L180 100" />
  <path class="arrow" d="M190 220 L190 200" />
  <path class="arrow" d="M190 286 L190 300" />
  <path class="arrow" d="M190 360 L190 380" />
  <path class="arrow" d="M190 452 L190 470" />

  <!-- Client column -->
  <text x="680" y="60" text-anchor="start" class="small">Client / Hooks / Components</text>

  <g transform="translate(520,90)">
    <rect class="box" x="0" y="0" width="300" height="56" />
    <text x="150" y="34" text-anchor="middle" class="title">useLedgerByForexData</text>
    <text x="150" y="50" text-anchor="middle" class="small">fetch('/api/journalmaster') → rawData, filterOptions</text>

    <rect class="box" x="0" y="110" width="320" height="86" />
    <text x="160" y="140" text-anchor="middle" class="title">useLedgerByForexFiltering(rawData, filters)</text>
    <text x="160" y="158" text-anchor="middle" class="small">system-row creation • date-window • dual balances</text>
    <text x="160" y="174" text-anchor="middle" class="small">returns { displayData, systemRowInfo, filteringStats }</text>

    <rect class="box" x="0" y="240" width="280" height="56" />
    <text x="140" y="272" text-anchor="middle" class="title">page.tsx</text>
    <text x="140" y="288" text-anchor="middle" class="small">Uses data hook + filtering hook; manages filters</text>

    <rect class="box" x="0" y="330" width="320" height="56" />
    <text x="160" y="362" text-anchor="middle" class="title">AdvancedJournalFilters</text>
    <text x="160" y="378" text-anchor="middle" class="small">UI to set `filters` (acName mandatory)</text>

    <rect class="box" x="0" y="420" width="320" height="66" />
    <text x="160" y="452" text-anchor="middle" class="title">LedgerByForexTable</text>
    <text x="160" y="470" text-anchor="middle" class="small">Renders `displayData` + highlights system-row, colors balances</text>
  </g>

  <!-- Arrows client -->
  <path class="arrow" d="M320 502 L520 502" />
  <path class="arrow" d="M760 112 L760 132" />
  <path class="arrow" d="M760 206 L760 240" />
  <path class="arrow" d="M760 318 L760 330" />
  <path class="arrow" d="M760 402 L760 420" />

  <!-- Cross link: API Response -> useLedgerByForexData -->
  <path class="arrow" d="M320 502 L520 130" />

  <!-- Legend box -->
  <rect x="920" y="560" width="240" height="110" rx="8" fill="#fff" stroke="#334155"/>
  <text x="1040" y="586" text-anchor="middle" class="small">Legend</text>
  <text x="960" y="606" class="small">• system-row: opening adjustments</text>
  <text x="960" y="626" class="small">• dual balances: `balance` & `ownBalance`</text>
  <text x="960" y="646" class="small">• server filters applied before client fetch</text>

</svg>